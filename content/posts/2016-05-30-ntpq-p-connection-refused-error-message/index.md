---
title: "ntpq -p connection refused error message"
date: 2016-05-30
categories: 
  - "vmware"
---

Sometimes a small misconfiguration can cause havoc in a complex distributed system. It becomes really annoying when no proper output is provided by log files and status report. While investigating time issues in my lab I ran into the following error message while executing the `ntpq -p` command: [![01-ntpq-p connection refused](images/01-ntpq-p-connection-refused.png)](http://frankdenneman.nl/wp-content/uploads/2016/05/01-ntpq-p-connection-refused.png) **TL;DR** NTP client is disabled, enable it via the GUI The standard NTP query program (ntpq) is one of the quickest way to verify that the Network Time Protocol Daemon (ntpd) is up and running. The command `ntpq -p` prints a list of peers known to the ESXi host as well as a summary of their state. Running the command on another ESXi host provided the following output. [![02-ntpq -p feedback](images/02-ntpq-p-feedback.png)](http://frankdenneman.nl/wp-content/uploads/2016/05/02-ntpq-p-feedback.png) Requesting the status of the NTPD status on the host with weird time issues, shows it's not running. No proper feedback is provided by the command line other than it's starting, no failure code is returned. [![03.NTPD status](images/03.NTPD-status.png)](http://frankdenneman.nl/wp-content/uploads/2016/05/03.NTPD-status.png) Management service initialisation, such as ntpd starts are logged in the file /var/log/syslog.log in ESXi 5.1 and up. Unfortunately, nothing useful is logged in this logfile as well. [![04.syslog.log output](images/04.syslog.log-output.png)](http://frankdenneman.nl/wp-content/uploads/2016/05/04.syslog.log-output.png) I couldn't find a command that provides accurate output whether the NTP client was enabled or not. Time to open up the web client. Host time configuration can be found when selecting the ESXi host, Manage, Time Configuration. Apparently NTP was not enabled. [![05-NTP client disabled](images/05-NTP-client-disabled.png)](http://frankdenneman.nl/wp-content/uploads/2016/05/05-NTP-client-disabled.png) Simple problem to fix, unfortunately there is no simple command line function that allows to verify while NTP client is enabled (sans PowerCli)
